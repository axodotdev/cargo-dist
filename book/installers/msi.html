<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js oranda-dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>msi - dist</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">
        <link rel="stylesheet" href="../oranda-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "oranda-dark" : "oranda-dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('orandamdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('orandamdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('orandamdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('oranda-dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../install.html"><strong aria-hidden="true">2.</strong> Install</a></li><li class="chapter-item expanded "><a href="../quickstart/index.html"><strong aria-hidden="true">3.</strong> Quickstart</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quickstart/rust.html"><strong aria-hidden="true">3.1.</strong> Rust</a></li><li class="chapter-item expanded "><a href="../quickstart/javascript.html"><strong aria-hidden="true">3.2.</strong> JavaScript</a></li><li class="chapter-item expanded "><a href="../quickstart/everyone-else.html"><strong aria-hidden="true">3.3.</strong> Everyone Else</a></li></ol></li><li class="chapter-item expanded "><a href="../updating.html"><strong aria-hidden="true">4.</strong> Updating</a></li><li class="chapter-item expanded "><a href="../troubleshooting.html"><strong aria-hidden="true">5.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../custom-builds.html"><strong aria-hidden="true">6.</strong> Custom Builds</a></li><li class="chapter-item expanded "><a href="../supplychain-security/index.html"><strong aria-hidden="true">7.</strong> Supplychain Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../supplychain-security/signing/windows.html"><strong aria-hidden="true">7.1.</strong> Windows Signing</a></li><li class="chapter-item expanded "><a href="../supplychain-security/attestations/github.html"><strong aria-hidden="true">7.2.</strong> GitHub Attestations</a></li></ol></li><li class="chapter-item expanded "><a href="../installers/index.html"><strong aria-hidden="true">8.</strong> Installers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installers/shell.html"><strong aria-hidden="true">8.1.</strong> shell</a></li><li class="chapter-item expanded "><a href="../installers/powershell.html"><strong aria-hidden="true">8.2.</strong> powershell</a></li><li class="chapter-item expanded "><a href="../installers/npm.html"><strong aria-hidden="true">8.3.</strong> npm</a></li><li class="chapter-item expanded "><a href="../installers/homebrew.html"><strong aria-hidden="true">8.4.</strong> homebrew</a></li><li class="chapter-item expanded "><a href="../installers/msi.html" class="active"><strong aria-hidden="true">8.5.</strong> msi</a></li><li class="chapter-item expanded "><a href="../installers/updater.html"><strong aria-hidden="true">8.6.</strong> updater</a></li><li class="chapter-item expanded "><a href="../installers/usage.html"><strong aria-hidden="true">8.7.</strong> Usage</a></li></ol></li><li class="chapter-item expanded "><a href="../artifacts/index.html"><strong aria-hidden="true">9.</strong> Artifacts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../artifacts/archives.html"><strong aria-hidden="true">9.1.</strong> archives</a></li><li class="chapter-item expanded "><a href="../artifacts/checksums.html"><strong aria-hidden="true">9.2.</strong> checksums</a></li><li class="chapter-item expanded "><a href="../artifacts/symbols.html"><strong aria-hidden="true">9.3.</strong> symbols</a></li></ol></li><li class="chapter-item expanded "><a href="../ci/index.html"><strong aria-hidden="true">10.</strong> CI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ci/customizing.html"><strong aria-hidden="true">10.1.</strong> Customizing</a></li></ol></li><li class="chapter-item expanded "><a href="../workspaces/index.html"><strong aria-hidden="true">11.</strong> Workspaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../workspaces/structure.html"><strong aria-hidden="true">11.1.</strong> Structure</a></li><li class="chapter-item expanded "><a href="../workspaces/simple-guide.html"><strong aria-hidden="true">11.2.</strong> A Simple Application</a></li><li class="chapter-item expanded "><a href="../workspaces/workspace-guide.html"><strong aria-hidden="true">11.3.</strong> More Complex Workspaces</a></li><li class="chapter-item expanded "><a href="../workspaces/cargo-release-guide.html"><strong aria-hidden="true">11.4.</strong> Using cargo-release</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">12.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/concepts.html"><strong aria-hidden="true">12.1.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="../reference/artifact-url.html"><strong aria-hidden="true">12.2.</strong> Artifact URLs</a></li><li class="chapter-item expanded "><a href="../reference/config.html"><strong aria-hidden="true">12.3.</strong> Config</a></li><li class="chapter-item expanded "><a href="../reference/cli.html"><strong aria-hidden="true">12.4.</strong> CLI Manual</a></li><li class="chapter-item expanded "><a href="../reference/schema.html"><strong aria-hidden="true">12.5.</strong> dist-manifest.json</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-dark">Axo Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-light">Axo Light</button></li>

                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">dist</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/axodotdev/cargo-dist" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/axodotdev/cargo-dist/edit/main/book/src/installers/msi.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="msi-installer"><a class="header" href="#msi-installer">msi Installer</a></h1>
<blockquote>
<p>Since 0.3.0</p>
</blockquote>
<ul>
<li><a href="#setup">Setup</a>
<ul>
<li><a href="#setup-step-1-set-authors-in-your-cargotoml">Setup Step 1: set "authors" in your Cargo.toml</a></li>
<li><a href="#setup-step-2-run-init-and-enable-msi">Setup Step 2: run init and enable "msi"</a></li>
<li><a href="#setup-step-3-youre-done-time-to-test">Setup Step 3: you're done! (time to test)</a></li>
</ul>
</li>
<li><a href="#how-it-works">How It Works</a></li>
<li><a href="#advanced-usage">Advanced Usage</a>
<ul>
<li><a href="#managed-advanced-usage">Managed Advanced Usage</a></li>
<li><a href="#unmanaged-advanced-usage">Unmanaged Advanced Usage</a></li>
</ul>
</li>
</ul>
<p>This guide will walk you through setting up a <a href="./index.html#bundling-installers">bundling</a> Windows msi installer. It assumes you've already done initial setup of dist, as described in <a href="../quickstart/index.html">the way-too-quickstart</a>, and now want to add an msi to your release process.</p>
<p>(Just a bit of a warning, this stuff works but there's a few rough edges, please let us know if you run into any issues!)</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>We'll start with the bare-minimum and then explain what we did and how to modify it afterwards.</p>
<h3 id="setup-step-1-set-authors-in-your-cargotoml"><a class="header" href="#setup-step-1-set-authors-in-your-cargotoml">Setup Step 1: set "authors" in your Cargo.toml</a></h3>
<p>msi requires you to specify a "manufacturer" for you application, which is by default sourced from the "authors" field in you Cargo.toml. <strong>If you donâ€™t have that field set, the next step will error out.</strong> If you have an authors entry like <code>My Cool Company &lt;support@mycoolcompany.org&gt;</code> then the manufacturer will be "My Cool Company".</p>
<h3 id="setup-step-2-run-init-and-enable-msi"><a class="header" href="#setup-step-2-run-init-and-enable-msi">Setup Step 2: run init and enable "msi"</a></h3>
<p>Rerun <code>dist init</code> and when it prompts you to choose installers, enable "msi".</p>
<p>Once init completes, some changes will be made to your project, <strong>check all of them in</strong>:</p>
<ol>
<li><code>installers = ["msi"]</code> will be added to <code>[workspace.metadata.dist]</code></li>
<li><code>[package.metadata.wix]</code> will be added to your packages with distable binaries. This is your msi-specific config. For now don't worry about it.</li>
<li><code>wix/main.wxs</code> will be created for each of your packages with distable binaries. This is a template for your msi. For now assume this file is completely managed by dist, and can't be hand-edited.</li>
</ol>
<h3 id="setup-step-3-youre-done-time-to-test"><a class="header" href="#setup-step-3-youre-done-time-to-test">Setup Step 3: you're done! (time to test)</a></h3>
<p>See <a href="../quickstart/rust.html#test-it-out">the quickstart's testing guide</a> for the various testing options.</p>
<p>If the above steps worked, <code>dist plan</code> should now include an msi for each Windows platform you support.</p>
<p><code>dist build</code> is a bit trickier. Not only do you have to be on Windows to get an msi built, you also need to have the <a href="https://wixtoolset.org/docs/wix3/">WiX v3 toolchain</a> installed (WiX v4 isn't yet supported). If you don't the build will just error out. In GitHub CI the WiX v3 toolchain is pre-installed, so using PR testing is recommended.</p>
<p>The resulting msi should include the following functionality:</p>
<ul>
<li>(optional) EULA dialog</li>
<li>A menu that lets you choose where to install and whether to add it to PATH
<ul>
<li>Default install location is <code>%ProgramFiles%\{app_name}\</code> (e.g. <code>C:\Program Files\axolotlsay\</code>)</li>
<li>Default is to add the install location to PATH</li>
<li>Currently the only files that will be included are the app's binaries in a <code>bin</code> subdir</li>
</ul>
</li>
<li>If rerun, you will get an uninstall/reinstall menu</li>
<li>If a newer version is run, it will automatically uninstall the old version</li>
<li>If an older version is run, it will report that a newer version is installed and exit</li>
<li>The application will appear in the Windows "Add or remove programs" menu and can be uninstalled from there</li>
</ul>
<p>Certain licenses in your Cargo.toml like "Apache" or "MIT" (but <em>not</em> dual MIT/Apache) will get an auto-generated EULA that's just agreeing to the software license -- we know, that's not how software licenses work, but people seem to like to do it. See the section on advanced usage for how to set a more useful EULA.</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<p>As you may suspect from the setup, we rely on the industry standard <a href="https://wixtoolset.org/docs/wix3/">WiX v3 toolchain</a> to generate your msi installers (WiX v4 isn't yet supported). The <code>main.wxs</code> format is its xml-based templating system. Some of the information about your app is baked into this template (binaries, descriptions, licenses...), while other information is sourced at build time (mostly the version).</p>
<p>If the template ever desyncs from the values it was generated from, commands like <code>dist plan</code> (and therefore your pull request CI) will error out and ask you to rerun <code>dist init</code> to regenerate it.</p>
<p>The values we added to <code>[package.metadata.wix]</code> are:</p>
<ul>
<li><code>upgrade-guid = "SOME-RANDOM-GUID"</code> (since 0.3.0)</li>
<li><code>path-guid = "SOME-OTHER-RANDOM-GUID"</code> (since 0.3.0)</li>
<li><code>license = false</code> (since 0.5.0)</li>
<li><code>eula = false</code> (since 0.5.0)</li>
</ul>
<p>The two GUIDs are used by Windows to determine that two MSIs with different versions refer to the same application and install location, which is required for it to properly handle things like upgrades. They are persisted in your Cargo.toml to keep them stable across regenerations of <code>main.wxs</code>.</p>
<p>The license/EULA settings are there to disable the auto-license/EULA feature of cargo-wix. That feature <em>would</em> look at your package's license and potentially turn it into a EULA agreement. While this is a thing some folks want, most of our users aren't interested in getting their end-users to "agree to the MIT License". You can opt back into auto-EULAs by setting both of those to <code>true</code> (if you just delete the keys dist will keep adding them back as <code>false</code>).</p>
<p><strong>All of the logic for generating wxs files is part of <a href="https://volks73.github.io/cargo-wix/cargo_wix/">cargo-wix</a>, which dist includes as a library.</strong> It's a great project we happily contribute to, although some TLC is still needed to make the integration perfect (some of its warnings/errors may mention its own CLI's flags, and those sure won't work if you pass them to dist). The <code>[package.metadata.wix]</code> config is purely cargo-wix's, see <a href="https://volks73.github.io/cargo-wix/cargo_wix/">their docs for all the knobs it exposes</a>.</p>
<h2 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced Usage</a></h2>
<p>There are two paths for advanced usage: managed and unmanaged. We recommend the managed approach, but the unmanaged approach is there for true power users.</p>
<h3 id="managed-advanced-usage"><a class="header" href="#managed-advanced-usage">Managed Advanced Usage</a></h3>
<p>If you want dist to be able to keep your <code>main.wxs</code> consistent with the definitions in your Cargo.tomls, then all you have available is the knobs exposed in <code>[package.metadata.wix]</code> -- see <a href="https://volks73.github.io/cargo-wix/cargo_wix/">cargo-wix's docs for details</a>.</p>
<h3 id="unmanaged-advanced-usage"><a class="header" href="#unmanaged-advanced-usage">Unmanaged Advanced Usage</a></h3>
<p>If you're not worried about keeping <code>main.wxs</code> consistent, then you can choose to dive deep into the full power of <a href="https://wixtoolset.org/docs/wix3/">WiX v3</a> by adding <code>allow-dirty = ["msi"]</code> to your dist config. Once you do this dist will stop trying to update it, and won't check if it's out of date.</p>
<p>At that point you can make whatever hand-edits you want to main.wxs, as long as you still use the variables that cargo-wix injects into the template at build-time for things like versions and binary paths.</p>
<p>See <a href="https://wixtoolset.org/docs/wix3/">WiX v3's docs</a> for all the things their format supports.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../installers/homebrew.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../installers/updater.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../installers/homebrew.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../installers/updater.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
